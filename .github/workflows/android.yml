name: Android CI

on: [push]

jobs:
  build:

    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v1
    - name: set up JDK 1.8
      uses: actions/setup-java@v1
      with:
        java-version: 1.8
    - name: Build with Gradle
      env:
        MAESTRO_TOKEN: ${{ secrets.AL_MAESTRO_TOKEN }}
        MAESTRO_DEVICE_NAME: office-fire-tv
        MAESTRO_APP_NAME: Maestro Media Center
        MAESTRO_APP_ID: ca.omny.videos.maestro
      run: ./gradlew build
    - name: Upload binary to S3 bucket
      uses: tpaschalis/s3-sync-action@master
      with:
       args: --acl public-read
      env:
        FILE: ./app/build/outputs/apk/debug/app-debug.apk
        AWS_REGION: 'us-east-1'
        AWS_S3_BUCKET: ${{ secrets.AWS_S3_BUCKET }}
        AWS_ACCESS_KEY_ID: ${{ secrets.AWS_ACCESS_KEY_ID }}
        AWS_SECRET_ACCESS_KEY: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
